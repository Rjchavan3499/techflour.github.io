var C5MigrationConsole=new function(){this.featureCounter=1;this.showMigrationConsoleScreen=function(){"undefined"!=typeof ZCGlobal&&ZCGlobal.showC5MigrationConsole&&(C5MigrationConsole.initBinding(),$("#c5MigrationContainer").show(),$(document.body).addClass("zc-mig-console-c4-alert"))};this.initBinding=function(){$("#validateNowC5").off("click").on("click",function(){window.open("/userhome/"+ZCGlobal.scopeName+"/migrateToC5","_blank");$("#c5MigrationContainer").hide();$(document.body).removeClass("zc-mig-console-c4-alert")});
$("#validateLaterC5").off("click").on("click",function(){C5MigrationConsole.upgradeLater()});$("#updateNewPop").off("click").on("click",function(){C5MigrationConsole.showNewPopFailureBlock()});$("a[elname\x3d'contactSupport']").off("click").on("click",function(){C5MigrationConsole.mailToSupport()});$(".zc-mig-pagination-right-btn").off("click").on("click",function(){C5MigrationConsole.showNextC5Features()});$(".zc-mig-pagination-left-btn").off("click").on("click",function(){C5MigrationConsole.showPrevC5Features()});
$("#migrateToC5").off("click").on("click",function(){C5MigrationConsole.showMigrationConfirmation()});$("#migrateToC5").parent().mouseenter(function(){$(this).addClass("zc-mig-upgrade-btn-focus")}).mouseleave(function(){5!=C5MigrationConsole.featureCounter&&$(this).removeClass("zc-mig-upgrade-btn-focus")});C5MigrationConsole.getMaxHeight($("#publicComponentsMain"));C5MigrationConsole.getMaxHeight($("#paymentConfigMain"))};this.upgradeLater=function(){var a={};void 0!=ZCGlobal.csrfTokenName?a[ZCGlobal.csrfTokenName]=
ZCGlobal.csrfToken:a[getCsrfParamName()]=getCsrfParamValue();$.ajax({url:"/userhome/"+ZCGlobal.scopeName+"/upgradeLater",type:"POST",data:a,success:function(a){$("#c5MigrationContainer").hide();$(document.body).removeClass("zc-mig-console-c4-alert")}})};this.showNewPopulationSuccess=function(){$("#updateNewPop").hide();$("#newPopSuccess").show()};this.showNewPopFailureButton=function(){$("#updateNewPop").hide();$("#newPopFailButton").show()};this.showNewPopFailureBlock=function(){$("#newPopMigContainer").hide();
$("#newPopFailContainer").show()};this.mailToSupport=function(){$.ajax({url:"/userhome/"+ZCGlobal.scopeName+"/contactSupportForDeluge",data:ZCGlobal.csrfTokenName+"\x3d"+ZCGlobal.csrfToken,type:"POST",beforeSend:showLoading,success:function(a){showToast("mail has been sent to support@zohocreator.com");hideLoading()}})};this.showNextC5Features=function(){prevFeature="c5Feature"+C5MigrationConsole.featureCounter;nextFeature="c5Feature"+ ++C5MigrationConsole.featureCounter;5==C5MigrationConsole.featureCounter&&
($("#migrateToC5").parent().addClass("zc-mig-upgrade-btn-focus"),$("#migrateToC5").parent().addClass("zc-mig-upgrade-btn-active"));$("#"+prevFeature).hide();$("#"+nextFeature).show()};this.showPrevC5Features=function(){prevFeature="c5Feature"+C5MigrationConsole.featureCounter;nextFeature="c5Feature"+--C5MigrationConsole.featureCounter;5>C5MigrationConsole.featureCounter&&($("#migrateToC5").parent().removeClass("zc-mig-upgrade-btn-focus"),$("#migrateToC5").parent().removeClass("zc-mig-upgrade-btn-active"));
$("#"+prevFeature).hide();$("#"+nextFeature).show()};this.showMigrationConfirmation=function(){var a={isEnable:!0};a[ZCGlobal.csrfTokenName]=ZCGlobal.csrfToken;iCustomizePopup({title:"Upgrading to C5",body:"\x3cspan class\x3d'zc-mig-upgrade-text'\x3eBy clicking Upgrade, you agree to upgrade your account to Creator 5\x3c/span\x3e",buttons:[{name:"Upgrade",type:ZCModalConstants.MODAL_SUBMIT},{name:ZCButton.CANCEL,type:ZCModalConstants.MODAL_CANCEL}],success:function(c){$.ajax({beforeSend:showLoading,
url:"/userhome/"+ZCGlobal.scopeName+"/updateC5Prop",type:"POST",data:a}).done(function(a){a.success?C5MigrationConsole.showMigrationRunning():a.error&&"migrationError"==a.errorType?window.open("/userhome/"+ZCGlobal.scopeName+"/migrateToC5","_self"):a.error&&"noPermission"==a.errorType?iAlert(a.error):a.error&&"sandboxDependency"==a.errorType?a.htmlContent?iCustomizePopup({title:"",body:a.htmlContent,button:i18n.ok,success:function(){return!0},failure:$.noop}):iAlert("Something went wrong.."):iAlert("Something went wrong..")}).always(function(){hideLoading()});
return!0},failure:function(){}})};this.showMigrationRunning=function(){$("#migMainContainer").hide();$("#afterMigrationSuccess").hide();$(".zc-mig-success-container").addClass("zc_mig_loading");$("#loader").show();$(".zc-mig-content-header").hide();$("#migrationRunning").addClass("zc-mig-started").show();setTimeout(function(){C5MigrationConsole.checkStatus()},1E3)};this.showAfterMigrationSuccess=function(){$(".zc-mig-main-header").hide();$("#afterMigrationSuccess").show()};this.showAfterMigrationFailure=
function(){$("#migMainContainer").hide();$(".zc-mig-main-header").hide();$("#afterMigrationFailure").show()};this.checkStatus=function(){$.ajax({url:"/userhome/"+ZCGlobal.scopeName+"/checkMigrationStatus",type:"GET",success:function(a,c,b){void 0!==a.status&&1==a.status?setTimeout(function(){C5MigrationConsole.checkStatus()},5E3):window.open("/userhome/"+ZCGlobal.scopeName+"/migrateToC5","_self")}})};this.showPopup=function(a){iCustomizePopup({title:$("#"+a).find(".zc-mig-success-msg-alert-elem-title").text(),
body:$("#"+a).html(),parentClass:"zc-mic-console-userpermission-dialog",afterOpen:function(c){$(c).find(".zc-mig-success-msg-alert-elem-title").hide();$(c).find("#dem-app-search-field").off("keyup").on("keyup",function(){C5MigrationConsole.filter(a,$(event.target).val())})}})};this.filter=function(a,c){c=c.trim();var b=new RegExp(c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),"i");a="oldPaymentApps"===a||"publicShareComponents"===a?$(".zc-mic-console-userpermission-dialog").find(".zc-mig-fail-app-comp-details "):
$(".zc-mic-console-userpermission-dialog").find(".zc-mig-c5-dshbrd-preview-container").find(".zc-mig-c5-dshbrd-applist ");a.hide();0==a.filter(function(){return""==b||b.test($(this).attr("linkName"))||b.test($(this).attr("dispName"))||b.test($(this).find(".zc-mig-app-fail-comp-list").attr("formDispName"))}).show().length?($(".zc-mic-console-userpermission-dialog").find("#noresult").find("p").text(i18n["zc.onboarding.noappstobedisplayed"]),$(".zc-mic-console-userpermission-dialog").find("#noresult").show()):
$(".zc-mic-console-userpermission-dialog").find("#noresult").hide()};this.getMaxHeight=function(a){a=$(a).find(".zc-mig-fail-app-comp-details");for(var c=0,b=0;b<a.length;b++){var d=$(a[b]).outerHeight();d>c&&(c=d)}for(b=0;b<a.length;b++)$(a[b]).outerHeight(c+"px")}};